[ROVI ]()取扱説明書 DENSO

第1版

| 作成者     | 株式会社YOODS |
| ---------- | ------------- |
| 作成日     | 2024年3月25日 |
| 最終更新日 | 2024年3月25日 |

# 1.目次

[ROVI 取扱説明書 DENSO.. 1](#_Toc162352734)

[1.       目次.. 2](#_Toc162352735)

[2.       グローバル変数の設定.. 3](#_Toc162352736)

[3.       機能説明.. 3](#_Toc162352737)

[3.1.      ROVI_RESET. 3](#_Toc162352738)

[3.2.      ROVI_CAPTURE. 4](#_Toc162352739)

[3.3.      ROVI_SOLVE. 4](#_Toc162352740)

[3.4.      ROVI_RECIPE. 5](#_Toc162352741)

[3.5.      ROVI_DETECT. 5](#_Toc162352742)

[4.       VT サンプルプログラム.. 6](#_Toc162352743)

[4.1.      VT　MAINプログラム.. 6](#_Toc162352744)

[4.2.      VTプログラム（補正動作）. 9](#_Toc162352745)

[4.3       VT　プログラム　（キャリブレーション）. 10](#_Toc162352746)

[5.       エラーコード. 12](#_Toc162352747)

# 2.グローバル変数の設定

 ROVI機能を使用する際は、処理結果を表示させる為、空いているグローバル変数に結果を代入してください。結果は整数で表示されます。OK ： 0 、NG : エラーコード

例：Dim res As Integer　　 ：ROVI命令処理結果

    Dim d_res As Integer　：特徴検出結果

I 0 = res

I 1 = d_res

# 3.機能説明

ROVI には以下の機能が含まれています。

・ROVI_RESET：撮影データクリア

・ROVI_CAPTURE：撮影

・ROVI_SOLVE：撮影データの解析

・ROVI_RECIPE：レシピ変更

・ROVI_DETECT：特徴検出

## 3.1.ROVI_RESET

・機能

　  撮影データをクリアします。

・引数

　なし

・戻り値

　resに正常終了時は0 、異常終了時はエラーコードを返します。

・使用例

**ROVI_RESET :**

　　　　res = rovi_reset ( )

　　　　If ( res < > 0 ) Then GoTo ON_ERROR

## 3.2.ROVI_CAPTURE

・機能

　 撮影動作を起動させます。

・引数

　なし

・戻り値

　 res に正常終了時は0 、異常終了時はエラーコードを返します。

・使用例

**ROVI_CAPTURE :**

　　　　Move P      '**撮影位置へ移動**

　　　　res = rovi_capture ()

　　　　If( res < > 0 ) Then GoTo ON_ERROR

## 3.3.ROVI_SOLVE

・機能

　  撮影データの解析処理を起動します。解析して得られた補正量をロボットコントローラーに返し

補正量の値をワーク座標系に代入して補正動作を行います。

・引数

　整数　（ ワーク座標系番号）　

・戻り値

　res に正常終了時は0 、異常終了時はエラーコードを返します。

　指定したワーク座標系番号に解析結果（補正量）を代入します。

・使用例

　ワーク座標系番号 「 2 」へ解析結果を代入します。

**ROVI_SOLVE :**

　　　  res = rovi_solve ( 2 )

　　　  If ( res < > 0 ) Then GoTo ON_ERROR

## 3.4.ROVI_RECIPE

・機能

　  マスターデータ （レシピ） を読み込みます。引数に呼び出すレシピ名を設定て実行します。

・引数

　文字列 （ レシピ名 ）

・戻り値

　 resに正常終了時は0 、異常終了時はエラーコードを返します。

・使用例

　“ TEST ” というレシピを読み込みます。

**ROVI_RECIPE :**

　　　　res = rovi_recipe ( " TEST " )

　　　　If ( res < > 0 ) Then GoTo ON_ERROR

## 3.5.ROVI_DETECT

・機能

　ROVI_SOLVEの結果を基に、撮影点群とマスターワークの特徴が一致するかどうか判定します。

ROVI_SOLVE 実行後にROVI_DETECTを実行してください。

品種を識別したい場合に使用します。

・引数

　文字列、整数　（ 特徴検出レシピ名 , 特徴検出結果代入先 ）　

・戻り値

　 res に正常終了時は0 、異常終了時はエラーコードを返します。

　 d_res に特徴の一致、不一致の結果を返します。

一致   ： 0

不一致 ： 1

エラー  ： 255

・使用例

“ TESTX4 ” というレシピの特徴と一致するか判定し、結果をd_resへ返します。

**ROVI_DETECT:**

　　res = rovi_detect ( " TESTX4 " , d_res )

# 4.VT サンプルプログラム

## 4.1.VT　MAINプログラム　

　この VT サンプルプログラム ( VTSample ) では以下を実行しています。

・ROVI 命令(RESET , CAPTURE , SOLVE , RECIPE,DETECT)　でPCとの通信を行い

   撮影～解析までを実行し、結果を基に補正動作をさせます。

 ・補正動作プログラムは別途作成してください。


| '!TITLE "VTサンプル"<br /><br />#Include "rovi.pcs"<br />#Include "VTMove.pcs"<br /><br />Sub Main<br />　　　　TakeArm Keep = 0<br />　　　　Dim res as integer <br />　　　　Dim d_res As integer<br /><br />PROC_START:<br />　　　　Move P, P20<br /><br />ROVI_RESET:<br />　　　　res=rovi_reset()<br />If(res<>0) Then GoTo ON_ERROR<br /><br />ROVI_RECIPE:<br />　　　　res=rovi_recipe("TEST")<br />　　　　If(res<>0) Tehn GoTo ON_ERROR<br /><br />ROVI_CAPTURE:<br />　　　　Move P, P21<br />　　　　Delay 2000<br />　　　　res=rovi_caputure()<br />　　　　If(res<>0) Then GoTo ON_ERROR<br /><br /><br />ROVI_SOLVE:<br />　　　　res=rovi_solve(2)<br />　　　　If(res<>0) Then GoTo ON_ERROR<br /><br />ROVI_DETECT:<br />　　　　res=rovi_detect("TESTX4", d_res)<br /><br />If(res<>0) Then GoTo ON_ERROR<br />　　　　If d_res=0 Then<br />　　　　　　　　GoTo VT_MOVE<br /><br />　　　　Else<br />　　　　　　GoTo ON_ERROR<br />　　　　End If<br /><br />VT_MOVE:<br />　　Call VTMove(2)<br /><br />　　GoTo PROC END<br /><br />PROC_END:<br />　　　　Move P, P20<br /><br />ON_ERROR:<br />I0=res<br />I1=d_res<br /><br />End Sub | 説明<br /><br />ROVI命令プログラムファイルを読み込みます<br />補正動作プログラムファイルを読み込みます<br /><br /><br /><br />処理結果を代入するresをローカル変数として設定<br />特徴検出処理結果を代入するd_resを<br />ローカル変数として設定<br /><br />HomePos<br /><br />前回撮影データをクリアします<br />PC処理結果をresへ代入します<br />処理結果NGの場合ラベルへジャンプさせます<br /><br /><br />ジョブ引数にレシピ名を設定し、レシピ読み込みを実行させます<br /> PC処理結果をresへ代入します<br />処理結果 NGの場合ラベルへジャンプさせます<br /><br /><br />撮影命令を実行します<br />撮影位置へ移動<br />※撮影対象、ロボット(カメラ)を完全に停止させてから撮影する<br />PC処理結果をresへ代入します<br />処理結果 NGの場合ラベルへジャンプさせます<br /><br /><br />解析処理を実行します<br />使用するワーク座標系番号を引数に設定 <br />PC処理結果をresへ代入します<br /><br />特徴検出処理を実行します<br />引数に特徴検出レシピ名、特徴検出処理結果を代入する<br />d_resを設定します<br />PC処理結果をresへ代入します<br />特徴検出結果が一致の場合、ラベルへジャンプさせます<br /><br />不一致、またはエラーの場合ラベルへジャンプさせます<br /><br /><br /><br /><br />引数に使用するワーク座標系番号を設定し<br />補正動作プログラムを呼び出します<br /><br /><br /><br />HomePos<br /><br />NG時ジャンプ先ラベル<br />処理結果のエラーコードをグローバル変数に代入して<br />結果を見えるようにします |
| :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |

## 4.2. VTプログラム（補正動作）

この VT サンプルプログラム ( VTMove ) では以下を実行しています。

・MAINプログラムで解析した結果を基に補正動作を行います。

   指定したワーク座標系番号に代入された補正量を使用し動作変換をします。

 ※教示の際は座標系、補正量に注意して作業を行ってください。


| '!TITLE  "教示"<br /><br />SubVTMove(wkcoord As Integer)<br />　　　　TakeArm Keep = 0<br />　　　　ChangeWork wkcoord<br /><br />　　　　Move P, P25<br /><br />　　　　Approach P, P26, @P 30<br />　　　　Move L, P26<br />　　　　Depart L, 30<br /><br />　　　　Move P, P25<br /><br />　　　　ChangeWork 0<br /><br />End SubEND | 説明<br /><br />MAINプログラムで設定したワーク座標系番号を使用します<br /><br />座標系を使用するワーク座標系に変更します<br /><br />中継ポイントへ移動<br /><br />目標ポイント上空へ移動<br />目標ポイントへ移動<br />目標ポイントから移動<br /><br /><br /><br />ワーク座標系からロボットベース座標系に変更<br /> |
| :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

## 4.3 [VT]()　プログラム　（キャリブレーション）

　この VT サンプルプログラム ( RCalib ) では以下を実行しています。

・ROVI 命令(RESET , CAPTURE)　でPCとの通信を行い、リセット～撮影を実行します。

撮影した結果を基にキャリブレーションを行います。


| '!TITLE"Calibｻﾝﾌﾟﾙ"<br /><br />Sub Main<br />　　　　TakeArm Keep = 0<br />　　　　Dim res As Integer<br /><br />PROC_START:<br />　　　　Move P, P30<br /><br />ROVI_RESET:<br />　　　　res=rovi_reset()<br />　　　　If (res<>0) Then GoTo ON_ERROR<br /><br />'ROVI_CAPTURE<br />　　　　Move P, P30<br />　　　　Delay 2000<br />　　　　res=rovi_capture()<br />　　　　If (res<>0) Then GoTo ON_ERROR<br /><br />'ROVI_CAPTURE:<br />　　　　Move P, P31<br />　　　　Delay 2000<br />　　　　res=rovi_capture()<br />　　　　If (res<>0) Then GoTo ON_ERROR<br /><br />〰〰〰〰〰〰〰<br /><br /><br />ROVI_CAPTURE:<br />　　　　Move P, P42<br />　　　　Delay 2000<br />　　　　res=rovi_capture()<br />　　　　If (res<>0) Then GoTo ON_ERROR<br /><br /><br />PROC_END:<br />　　　　Move P, P30<br /><br />ON_ERROR:<br /><br />End Sub<br /><br /> | 説明<br /><br /><br /><br />処理結果を代入するresをローカル変数として設定<br /><br /><br />Home Pos<br /><br />前回撮影データをクリアします<br />PC処理結果をresへ代入します<br /><br /><br /><br /><br />撮影姿勢①<br />※撮影対象、ロボット(カメラ)を完全に停止させてから撮影する<br />撮影命令を実行します<br />PC処理結果をresへ代入します<br /><br />撮影姿勢②へ移動<br />以下繰り返し<br /><br /><br /><br />〰〰〰[〰](https://file+.vscode-resource.vscode-cdn.net/c%3A/Users/tuchiyama/Desktop/md_manual/)〰〰〰<br /><br />5軸取付の場合、９か所<br />6軸取付の場合、13か所の撮影を推奨しています。<br />撮影位置は<br />「チュートリアル　キャリブレーション編」をご確認ください。<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /> |
| :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |



# 5.エラーコード

ロボットから PC にROVI 命令を出力した際にエラーが発生すると、PC はロボットにエラーコードを返します。

エラーコードの一覧を以下に示します。


| No. | エラーコード一覧 | 値  | 発生状況                                                | 処置                                                                         |
| --- | ---------------- | --- | ------------------------------------------------------- | ---------------------------------------------------------------------------- |
| 1   | システムビジー   | 900 | PCが指令を受付ない状態です                              |                                                                              |
| 2   | コマンド受付不可 | 901 | PCが指令を受付ない状態です                              | LANケーブル接続を 確認します                                                 |
| 3   | 撮影タイムアウト | 911 | 撮影コマンドを送信したが、<br />完了していません        | カメラケーブル接続を 確認します                                              |
| 4   | 撮影エラー       | 912 | 撮影時にエラーが発生しました                            | カメラドライバーを 再起動します                                              |
| 5   | 認識タイムアウト | 921 | ワーク認識コマンドを 送信したが、<br />完了していません | エラーが続く場合は、<br />システムを再起動します                             |
| 6   | 一致度エラー     | 922 | 一致度が低く誤認識の<br />リスクがあります              | 撮影条件を調整し、十分な<br />点群が撮れるようにします                       |
| 7   | 上下限エラー     | 923 | ワークは認識したが、<br />姿勢等が範囲外にあります      | 上下限値を外れている <br />レポート項目を確認し、 <br />エラー原因を除きます |

| No. | エラーコード一覧         | 値  | 発生状況                                             | 処置                                                |
| --- | ------------------------ | --- | ---------------------------------------------------- | --------------------------------------------------- |
| 8   | 座標ルックアップエラー   | 924 | 認識したワークの座標が<br />取得できません           | エラーが続く場合は、システム<br />を再起動します    |
| 9   | レシピ設定タイムアウト   | 931 | レシピの読み込みが完了<br />していません             | エラーが続く場合は、システム<br />を再起動します    |
| 10  | レシピ読込エラー         | 932 | レシピの読み込みでエラーが<br />発生しました         | 指定されたレシピが存在する<br />かどうか確認します  |
| 11  | 特徴検出タイムアウト     | 933 | レシピ読み込みが完了<br />していません               | エラーが続く場合は <br />システムを再起動します     |
| 12  | 特徴検出レシピ読込エラー | 934 | レシピ読み込みで<br />エラーが発生しました           | 指定されたレシピが <br />存在するかどうか確認します |
| 13  | 座標フォーマットエラー   | 999 | ロボットから送られた座標の<br />書式が間違っています | エラーが続く場合は、システム<br />を再起動します    |
