| VTチュートリアル ロボット接続編(FANUC) | Revision      | 第2版 |
| -------------------------------------- | ------------- | ----- |
| 作成者                                 | 株式会社YOODS |       |
| 作成日                                 | 2023年5月25日 |       |
| 最終更新日                             | 2024年2月29日 |       |

# 7.プログラムのロード ( FANUC )

| No   | 手順                                                                                                                                                                                          | 補足                                                                                                                                                                                                                                                                                                                                    |
| ---- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| A140 | PCデスクトップ「VTマニュアル」のリンクを選択して<br />ダブルクリックしてください。 <br /><br />  使用するロボットメーカーのフォルダを開き <br />「Robot_program」のフォルダを開いてください。 | ロボットへ必要なプログラムファイルを移行します。<br />TPプログラム <br />　●vt_main.tp <br />　●vt.move.tp <br />　●r_calib.tp <br />　●b_server.tp <br /><br />PCプログラム <br />　●rovi_capture.pc <br />　●rovi_detect.pc <br />　●rovi_recipe.pc <br />　●rovi_reset.pc <br />　●rovi_solve.pc <br />　●rovi_serever3.pc |
| A141 | PCへUSBメモリを挿してください。<br /><br />  選択したフォルダ内のファイルを <br />全てUSBへコピーしてください。 <br /><br />  コピー完了後、USBを抜いてください。                             | USBメモリフォルダは自動で出てきますが<br />出ない場合、ファイルマネージャーを開いて<br /> デバイス内のUSBフォルダを開いてください。 <br /><br />  USBを抜く際は、ファイルマネージャー左側メニュー<br />デバイス内にあるUSBの<br />![1724290452323](tutorial_FANUC/1724290452323.png)マークを押してから抜いてください。<br />        |
| A142 | TPへUSBメモリを挿して<br />USB内のファイルを全てTPへロードしてください。 <br />完了後、USBメモリを抜いてください。                                                                            | TPのUSB差し込み口は<br />ロボットメーカー取扱い説明書を参照してください。                                                                                                                                                                                                                                                               |

# 8.TPでの通信設定 ( FANUC )

| No   | 手順                                                                                                                                                                                                                                              | 補足                                                                                                                                                  |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| A150 | PCと通信するために<br />ロボットIPアドレス等を設定していきます。                                                                                                                                                                                  | バージョンによって操作方法が違うので、<br />ロボット取扱い説明書を参照してください。                                                                  |
| A151 | TPの 「画面選択」 ボタンを押してください。<br />「設定」 メニューから 「ホスト通信」 を <br />選んでください。                                                                                                                                    |                                                                                                                                                       |
| A152 | 「表示」 を選択して<br />「プロトコル」 を選んでください。                                                                                                                                                                                        |                                                                                                                                                       |
| A153 | プロトコル設定の 「TCP/IP詳細設定」 を<br />選んでロボットIPアドレス、サブネットマスクを <br />入力してください。 <br /><br />  ロボットIPアドレスを設定 <br />　　　 例) 192.168.221.10 <br />サブネットマスクを設定 <br /> 　　　255.255.255.0 | ![1724290557971](tutorial_FANUC/1724290557971.png)                                                                                                |
| A154 | 「前戻」 ボタンで前画面に戻り<br />「表示」 を選択して <br />「クライアント」 を選んでください。<br /><br />  ﾀｸﾞ1 C1:を選択して右記設定を <br />入力してください。                                                                            | ｺﾒﾝﾄ  : YOODS_VT<br />ﾌﾟﾛﾄｺﾙ  : SM <br />ｽﾀｰﾄｱｯﾌﾟ時の操作 :定義する <br />IP/ﾎｽﾄ名 : 192.168.221.2 <br />ﾘﾓｰﾄﾎﾟｰﾄ : 3000 |
|      | 入力後、 「操作」 ボタンを押して<br />「定義する」 を選択、実行してください。<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />                                                                                                         | ![1724290615322](tutorial_FANUC/1724290615322.png)                                                                                                |
| A155 | 「前戻」 ボタンで前画面に戻り<br />「表示」 を選択して <br />「サーバ」 を選んでください。<br /><br />  ﾀｸﾞ5 S5:　を選択して右記設定を <br />入力してください。                                                                                | ｺﾒﾝﾄ  : YOODS_VT<br />ﾌﾟﾛﾄｺﾙ  : SM <br />ｽﾀｰﾄｱｯﾌﾟ時の操作 :スタートする <br />応答時間切れ : 1 min                                  |
| A156 | 入力後、「操作」 ボタンを押して<br />「定義する」 → 「スタートする」 の順で <br />選択、実行してください。<br />                                                                                                                                 |                                                                                                                                                       |

# 9.システム変数設定 ( FANUC )

| No   | 手順                                                                                                                                                                                                                           | 補足                                                   |
| ---- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------ |
| A160 | TPの 「画面選択」 ボタンを押してください。<br />「システム」 メニューから 「システム変数」 を <br />選んでください。                                                                                                           |                                                        |
| A161 | 「$HOST**C** _CFG」 を選び <br />A154で選択したタグ番号を開いてください。 <br />（ デフォルト：1 [1]）                                                                                                                   | ![1724292440442](tutorial_FANUC/1724292440442.png) |
| A162 | A154で入力した内容が反映されているか<br />確認してください。<br /><br />COMMENT : YOODS_VT <br />PROTOCOL  : SM <br />OPER : 2 (定義する) <br />STATE : 2 (定義済) <br />STRT_REMOTE : 192.168.221.2 <br />$SERVER_PORT : 3000 | ![1724292594777](image/tutorial_FANUC/1724292594777.png) |
| A163 | 「$KAREL_ENB」　を選び 「1」を<br />入力してください。                                                                                                                                                                         | ![1724292641638](tutorial_FANUC/1724292641638.png) |

# 10.通信の実行と確認 ( FANUC )

| No   | 手順                                                                                                                                   | 補足                                                   |
| ---- | -------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------ |
| A170 | TPの 「画面選択」 ボタンを押してください。<br />「設定」 メニューから 「バックグランド演算」 を <br />選んでください。                 |                                                        |
| A171 | 空いている番号にカーソルを合わせて<br />「選択」 ボタンを押してください。                                                              | ![1724293080687](tutorial_FANUC/1724293080687.png) |
| A172 | 「プログラム」 の中から<br />ロードしたプログラム「B_SERVER」 を<br />選択してください。                                               |                                                        |
| A173 | 設定ができたら 「実行」 を押した後、<br />電源再投入してください。<br /> 電源再投入後、プログラムが実行されているか <br />確認します。 | VTが起動、接続されている状態で<br />ご確認ください。   |
| A174 | プログラム 「一覧」 ボタンを押して<br />「タイプ」 から 「カレル」 を選択してください。                                                |                                                        |

| A175 | ロードしたプログラム 「ROVI_SERVER3」 を<br />選択、「データ」 ボタンを押し <br />「画面」 ボタンから 「カレル変数」 を <br />選択してください。 |                                                        |
| ---- | :----------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------ |
| A176 | CONNECTED_の欄が 「TRUE」 に<br />なっていれば通信ができている状態です。                                                                         | ![1724293266405](tutorial_FANUC/1724293266405.png) |
| A177 | SJ1_～SJ6はロボット各軸の現在値です。<br />ロボットを動かして数値が変化するか <br />確認してください。                                           | ![1724293343486](tutorial_FANUC/1724293343486.png) |


# 11.不具合時の復旧 ( FANUC )

| No   | 手順                                                                                                                                                                                      | 補足                                                                            |
| ---- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------- |
| A180 | VTとの通信プログラム 「B_SERVER」 では<br />「フラグ」 を使用しています。 <br /><br />  VTとの通信を行うためには <br />「B_SERVER」 実行中に 「フラグ１」 を <br />ONする必要があります。 | 電源投入時は自動的に 「B_SERVER」が実行され、<br />「フラグ１」 が ONされます。 |
|      |                                                                                                                                                                                           |                                                                                 |
| A181 | 運転中、ロボットプログラムが停止した場合は<br />以降の手順で復旧してください。                                                                                                            |                                                                                 |
| A182 | TPの 「画面選択」 ボタンを押してください。<br />「設定」 メニューから 「バックグランド演算」 を <br />選んでください。                                                                    |                                                                                 |
| A183 | 設定してある 「B_SERVER」 に<br />カーソルを合わせ 「実行」 ボタンを押してください。<br /><br />  エラーが出ている場合は、一度 「停止」 を <br />押した後、「実行」 を押してください。    | ![1724293544995](tutorial_FANUC/1724293544995.png)                          |
| A184 | TPの 「画面選択」 ボタンを押してください。<br />「I/O」 メニューから 「フラグ」 を <br />選んでください。                                                                                 |                                                                                 |
| A185 | 「#1」 にカーソルを合わせて 「オン」 を <br />押してください。<br /><br />  「オン」 を押した後、すぐ自動的に <br />「オフ」 に切り替わります。                                           | ![1724293606375](tutorial_FANUC/1724293606375.png)                          |
| A186 | A174～A177の項目を確認して通信状態を<br />確認してください。                                                                                                                              |                                                                                 |

**改定履歴**

| #     | 日付          | 内容                                                          |
| ----- | ------------- | ------------------------------------------------------------- |
| 初版  | 2023年5月25日 |                                                               |
| 第2版 | 2024年2月29日 | 軸値送信対応 プログラム(ROVI_SERVER3 ,B_SERVER)、通信設定追加 |
