ROVI 取扱説明書 ELITE

第1版

| 作成者     | 株式会社YOODS |
| ---------- | ------------- |
| 作成日     | 2024年3月15日 |
| 最終更新日 | 2024年3月15日 |

# [目次]()

[1.  目次............................................................................................... 1](#_Toc1005779625)

[2.  グローバル変数・座標系の設定........................................................... 2](#_Toc1347000190)

[3.  機能説明......................................................................................... 3](#_Toc1593230779)

[3.1.ROVI_RESET............................................................................. 3](#_Toc767054566)

[3.2.ROVI_CAPTURE....................................................................... 3](#_Toc1694444781)

[3.3.ROVI_SOLVE............................................................................. 3](#_Toc1091794407)

[3.4.ROVI_RECIPE........................................................................... 4](#_Toc1203591681)

[3.5.ROVI_DETECT.......................................................................... 4](#_Toc1289440473)

[4.  VT
サンプルプログラム..................................................................... 5](#_Toc2012707010)

[4.1.VTサンプルプログラム（MAIN、SUB）............................................ 6](#_Toc1066899300)

[4.2.VTサンプルプログラム（キャリブレーション）...................................... 8](#_Toc655392911)

[5.  エラーコード................................................................................... 11](#_Toc158390897)

# [グローバル変数・座標系の設定]()

 ROVI 機能を使用する際は、別添えの 「ロボットグローバル変数表」を参考にグローバル変数および座標系を設定します。

# [機能説明]()

ROVI には以下の機能が含まれています。

・ROVI_RESET :撮影データクリア

・ROVI_CAPTURE: 撮影

・ROVI_SOLVE :撮影データの解析

・ROVI_RECIPE: レシピ変更

・ROVI_DETECT: 特徴検出（品種の識別）


## [ROVI_RESET]()

・機能

　　撮影データをクリアします。

・引数

　　なし

・戻り値

　　ブーリアン型

・使用例

　　　　　**ROVI_RESET()**


## [ROVI_CAPTURE]()

・機能

　　YCAM の撮影動作を起動し、この指令を実行したときのロボットのポーズをPC に返します。

・引数

　なし

・戻り値

　ブーリアン型

・使用例

　　　　　**ROVI_CAPTURE()**


## [ROVI_SOLVE]()

・機能

　　撮影データの解析処理を起動します。解析して得られたベース座標の補正量をロボットコントローラーに返します。

　　解析結果が NG の場合は戻り値のポーズ変数の1 成分目に 10000 が出力されます。

・引数

　なし

・戻り値

　ポーズ型

・使用例

　ポーズ変数 Y2 にベース座標の補正量を格納します。

　　　　　**Y2:= ROVI_SOLVE()**


## [ROVI_RECIPE]()

・機能

　　マスターワークに関連するデータ（レシピ）を読み込みます。

・引数

　文字列変数

・戻り値

　ブーリアン型

・使用例

　“Sample” というレシピを読み込みます。

　　　　**　recipe_name:= “Sample”**

**　　　　　ROVI_RECIPE(recipe)**


## [ROVI_DETECT]()

・機能

　ROVI_SOLVEの結果を基に、撮影点群とマスターワークの特徴が一致するかどうか判定します。

　ROVI_SOLVEの実行後に使用する必要があります。マスターワークの特徴点を抽出したレシピが必要になります。

　品種を識別したい場合に使用します。

・引数

　文字列変数

・戻り値

　ブーリアン型

・使用例

　“Samplex4” というレシピを読み込み、ROVI_SOLVEの結果を基に特徴検出を行います。

結果は変数d_res に格納されます。

一致: d_res = 0

不一致: d_res = 1

　　　　**recipe_detect:= “SampleX4”**

**　　　　ROVI_DETECT(recipe_detect)**


# VTサンプルプログラム

## 　[VT]()サンプルプログラム（MAIN、SUB）

・このVTサンプルプログラムでは以下の指令を実行しています。

・ROVI 命令のスクリプトを読み込む

・初期値 (recipe_nameおよび UF )を設定する

・ROVI_RECIPE(recipe_name)で recipe_name に設定したレシピを呼び出す

・ROVI_RESET で撮影データをクリアする

・ROVI_CAPTURE()でワークを撮影する

・Y2:=ROVI_SOLVE()で撮影データを解析し、ポーズ変数 Y2 に解析結果を出力する

・平面座標系UF にY2 を反映する

・教示動作 VT_MOVE(サブプログラム)を実行する　※補正したい教示動作の座標系を UF に設定しておくこと


| サンプルプログラムvt_main<br />変数設定<br />開始前シーケンス<br />　スクリプト:ROVI_RESET.script<br />　スクリプト: ROVI_CAPTURE.script<br />　スクリプト: ROVI_SOLVE.script<br />　スクリプト: ROVI_RECIPE.script<br />　スクリプト: ROVI_DETECT.script<br />ロボットプログラム<br />　INITIALIZE<br />　　recipe_name≔"Sample"<br />　　UF≔p[0.,0.,0.,0.,0.,0.]<br />　　recipe_detect≔"SampleX4"<br />　HOME<br />　　MoveJ<br />　　　HomePos<br />　ROVI_RECIPE<br />　　If ( not ROVI_RECIPE(recipe_name))<br />　　　停止<br />　ROVI_RESET<br />　　If ( not ROVI_RESET())<br />　　　停止<br />　ROVI_CAPTURE<br />　　MoveJ<br />　　　CaptPos<br />　　待機: 2.0<br />　　If ( not ROVI_CAPTURE())<br />　　　停止<br />　ROVI_SOLVE<br />　　Y2≔ROVI_SOLVE()<br />　　If (Y2[0]≟10000.)<br />　　　停止<br />　ROVI_DETECT<br />　　If ( not ROVI_DETECT(recipe_detect))<br />　　　停止<br />　　If文 d_res==1<br />　　　ポップアップ: ROVI_DETECT：特徴が一致しません<br />　　　停止<br /><br />　VT_MOVE<br />　　UF≔Y2<br />　　呼び出しVT_MOVE<br /><br />　HOME<br />　　MoveJ<br />　　　HomePos<br /><br />　VT_Move<br />　　MoveL<br />　　MoveJ<br />　　MoveL<br />　　　待機: 2.0<br />　　MoveJ<br />　　MoveL<br /><br /><br />　 | 説明<br /><br />必要なROVI命令のスクリプトを読み込む<br />撮影データクリア<br />撮影起動<br />解析処理起動<br />レシピ読み込み<br />特徴検出<br /><br />フォルダ<br />レシピ名”Sample”を設定<br />平面座標系をリセット<br />特徴検出レシピ名”SampleX4”を設定<br />フォルダ<br /><br /><br />フォルダ<br />レシピ読み込み<br />処理NGの場合プログラム停止<br />不一致の場合 d_resへ1が出力される<br />不一致時、ポップアップを出して停止<br /><br />フォルダ<br />解析結果を平面座標系「UF」へ反映<br />補正動作プログラムを呼び出し<br />フォルダ<br /><br />補正動作プログラム<br />※補正動作を実行したい移動ポイントは<br />　座標系を「UF」へ変更してください。 |
| :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

## [　]()[VT]()サンプルプログラム（キャリブレーション）

　この VT サンプルプログラムでは以下の指令を実行しています。

・ROVI 命令のスクリプトを読み込む

・ROVI_RESET で撮影データをクリアする

・撮影位置（CaptPos）に移動する

・ROVI_CAPTURE()でキャリブレーションボードを撮影する


| サンプルプログラムRCALIB_MANUAL<br />変数設定<br />開始前シーケンス<br />　スクリプト: ROVI_RESET.script<br />　スクリプト: ROVI_CAPTURE.script<br />　ロボットプログラム<br />　HOME<br />　　MoveJ<br />　　　HomePos<br />　ROVI_RESET<br />　　If ( not ROVI_RESET())<br />　　　停止<br />　ROVI_CAPTURE_01<br />　　MoveJ<br />　　　CaptPos<br />　　待機: 2.0<br />　　If ( not ROVI_CAPTURE())<br />　　　停止<br />　ROVI_CAPTURE_02<br />　　MoveJ<br />　　　CaptPos<br />　　待機: 2.0<br />　　If ( not ROVI_CAPTURE())<br />　　　停止<br />　ROVI_CAPTURE_03<br />　　MoveJ<br />　　　CaptPos<br />　　待機: 2.0<br />　　If ( not ROVI_CAPTURE())<br />　　　停止<br />　ROVI_CAPTURE_04<br />　　MoveJ<br />　　　CaptPos<br />　　待機: 2.0<br />　　If ( not ROVI_CAPTURE())<br />　　　停止<br /><br />〰〰〰[〰]()〰〰〰<br />ROVI_CAPTURE_013<br />　　MoveJ<br />　　　CaptPos<br />　　待機: 2.0<br />　　If ( not ROVI_CAPTURE())<br />　　　停止 | 説明<br /><br />必要なROVI命令のスクリプトを読み込む<br />撮影データクリア<br />撮影起動<br /><br />フォルダ<br /><br /><br />フォルダ<br />撮影データクリア<br />処理NGの場合プログラム停止<br />フォルダ<br />撮影位置へ移動<br /><br />※撮影対象、ロボット(カメラ)を完全に停止させてから撮影<br />撮影起動<br />処理NGの場合プログラム停止<br />以下繰り返し<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />〰〰〰〰〰〰〰<br />5軸取付の場合、９か所<br />6軸取付の場合、13か所の撮影を推奨しています。<br />撮影位置は<br />「チュートリアル　キャリブレーション編」をご確認ください。 |
| :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |



# 5.エラーコード

　ROVI 命令を実行した際にエラーが発生すると、エラーコードが返ります。エラーコードはグローバル変数の

rovi_errに格納されます。エラーコードの一覧を以下に示します。

| No. | エラーコード一覧             | 値  | 発生状況                                               | 処置                                                                                   |
| :-: | ---------------------------- | --- | ------------------------------------------------------ | -------------------------------------------------------------------------------------- |
|  1  | システムビジー               | 900 | PCが指令を受付ない状態です                             |                                                                                        |
|  2  | コマンド受付不可             | 901 | PCが指令を受付ない状態です                             | LANケーブル接続を確認します                                                            |
|  3  | ソケットオープンタイムアウト | 902 | ソケットオープン命令に<br /> 失敗した状態です          | グローバル変数が正しく <br />設定されているか確認します <br />(host,port, socket_name) |
|  4  | データ受信エラー             | 903 | PCからデータを受信できていない<br />状態です           | エラーが続く場合は、 <br />システムを再起動します                                      |
|  5  | 撮影タイムアウト             | 911 | 撮影コマンドを送信したが、 <br />完了していません      | カメラケーブル接続を確認します                                                         |
|  6  | 撮影エラー                   | 912 | 撮影時にエラーが発生しました                           | カメラドライバーを再起動します                                                         |
|  7  | 認識タイムアウト             | 921 | ワーク認識コマンドを送信したが、<br />完了していません | エラーが続く場合は、<br />システムを再起動します                                       |
|  8  | 一致度エラー                 | 922 | 一致度が低く誤認識のリスクが <br />あります            | 撮影条件を調整し、<br />十分な点群が 撮れるようにします                                |
|  9  | 上下限エラー                 | 923 | ワークは認識したが、姿勢等が <br />範囲外にあります    | 上下限値を外れている <br />レポート項目を確認し、 <br />エラー原因を除きます           |
| 10 | 座標ルックアップエラー       | 924 | 認識したワークの座標が <br />取得できません            | エラーが続く場合は、システムを<br />再起動します                                       |
| 11 | レシピ設定タイムアウト       | 931 | レシピの読み込みが<br /> 完了していません              | エラーが続く場合は、システムを <br />再起動します                                     |
| 12 | レシピ読込エラー             | 932 | レシピの読み込みでエラーが <br />発生しました          | 指定されたレシピが存在するか <br />確認します                                          |
| 13 | 座標フォーマットエラー       | 999 | ロボットから送られた座標の <br />書式が間違っています  | エラーが続く場合は、 <br />システムを再起動します                                      |
